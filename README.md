# Взлом казино (версия 2)

## Что это такое?

Это бот, который майнит VK Coin, используя бота [Coin Math](https://vk.com/coinmath).
[Предыдущая версия](https://github.com/shreddered/CasinoHackUltimate) этого проекта
была написана несколько лет назад и морально устарела.

## Как это работает?

Бот просит у [Coin Math](https://vk.com/coinmath) картинку какого-то уровня, после чего
распознает на ней заданный пример. Ответ отправляется обратно. Всё просто.

## Что нового в версии 2?

* Изменения в работе бота.
    * Теперь есть бинаризация изображений.
    * Полученное от бота изображение декодируется на ходу.
    * При любой ошибке (распознан бред/неправильный ответ) бот сдаётся и просит ответ.
* Сборка проекта переехала на _cmake_.
* Зависимости: вместо _curl_ теперь Boost.Beast (+ _OpenSSL_), прибавились _opencv_ и _nlohmann\_json_.
* Минорные исправления / улучшенный стиль кода.

## Подводные камни

Без них никак. Пока что они следующие:

* Поддерживается **только 12 уровень** (дроби).
* Бот сам не начнёт игру ("Играть" надо отправить ручками).
* Пока бот не может при принудительном завершении закончить игру. 

## Хорошо, а собирать как?

Можно либо собрать Docker-контейнер, либо сделать следующие действия:

1. Поставить зависимости: _tesseract_(отвечает за распознавание символов),
_opencv_ (декодинг и дальнейшая обработка полученного изображения), _cmake_ (пригодится для
сборки), Boost.Beast + _OpenSSL_ (работа с сетями), _nlohmann\_json_.
2. В директории с клонированным репозиторием сделать следующее
```bash
$ cmake -B build -D CMAKE_BUILD_TYPE=Release
$ cmake --build build

```
Зависимости ищутся с помощью `find_package()`. Исключения - _tesseract_ (на многих системах идёт без нужных для
_cmake_ файлов) и _OpenSSL_, он ищется ещё с помощью `pkg-config`. 

После этого в директории `build/` будет файл `bot`, который нужно запустить,
установив переменную окружения `$TOKEN`. Это было сделано для удобства работы с [heroku](https://heroku.com).
Более того, бот был создан именно для этой платформы. Бот заработает там, если воспользоваться Docker
(см. документацию).

## TODO

По убыванию приоритета:

- [ ] Научить бота начинать игру самостоятельно.
- [ ] При принудительном завершении заканчивать игру (привет, `setjmp()`).
- [ ] Сделать статистику для сессии майнинга.
- [ ] Переход к модульной системе и поддержка всех уровней.
- [ ] Поддержка заданного количества решённых примеров (не бесконечный майнинг).
